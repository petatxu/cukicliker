<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CukiCliker - Ranking Clase</title>
    <style>
        :root { --gold: #ffcc00; --panel: #2d2d2d; }
        body { background: radial-gradient(circle, #3e2723, #121212); color: white; font-family: sans-serif; display: flex; margin: 0; height: 100vh; overflow: hidden; }
        
        #login-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .btn-google { background: #db4437; color: white; padding: 15px 30px; border: none; border-radius: 8px; cursor: pointer; font-size: 1.2rem; font-weight: bold; }

        .game-container { flex: 1; display: flex; }
        
        /* Centro: Galleta */
        .seccion-galleta { flex: 1.5; display: flex; flex-direction: column; align-items: center; justify-content: center; border-right: 2px solid #000; }
        #puntos { font-size: 4rem; color: var(--gold); margin: 0; text-shadow: 0 0 15px rgba(255,204,0,0.3); }
        #galleta { width: 240px; height: 240px; cursor: pointer; font-size: 120px; display: flex; align-items: center; justify-content: center; background: #d2691e; border-radius: 50%; border: 8px solid #8b4513; transition: transform 0.05s; }
        #galleta:active { transform: scale(0.92); }
        #galleta::after { content: "üç™"; }

        /* Derecha: Ranking y Tienda */
        .seccion-derecha { width: 380px; background: var(--panel); display: flex; flex-direction: column; padding: 15px; }
        .ranking-box { flex: 1; background: #1a1a1a; margin-bottom: 15px; border-radius: 8px; padding: 10px; overflow-y: auto; }
        .rank-item { display: flex; justify-content: space-between; padding: 5px; border-bottom: 1px solid #333; font-size: 0.9rem; }
        .rank-item.top { color: var(--gold); font-weight: bold; }

        .tienda-box { flex: 1; overflow-y: auto; }
        .mejora { background: #3d3d3d; margin-bottom: 8px; padding: 12px; border-radius: 8px; display: flex; justify-content: space-between; cursor: pointer; border: 2px solid transparent; }
        .mejora.comprable { border-color: var(--gold); }
        .mejora.bloqueado { opacity: 0.5; cursor: not-allowed; }
        
        .user-info { position: absolute; top: 10px; left: 10px; display: flex; align-items: center; gap: 8px; }
        .user-info img { width: 30px; border-radius: 50%; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <h1>üç™ CukiCliker PRO</h1>
        <p>Inicia sesi√≥n para aparecer en el ranking de la clase</p>
        <button class="btn-google" id="btn-login">Entrar con Google</button>
    </div>

    <div class="user-info" id="ui-user" style="display:none;">
        <img id="user-pic" src="">
        <span id="user-display">Jugador</span>
    </div>

    <div class="game-container">
        <div class="seccion-galleta">
            <h1 id="puntos">0</h1>
            <div id="galleta"></div>
            <p>GPS: <span id="gps">0.0</span></p>
        </div>

        <div class="seccion-derecha">
            <h3 style="color:var(--gold); margin-top:0;">üèÜ TOP CLASE</h3>
            <div class="ranking-box" id="ranking-list">Cargando...</div>
            
            <h3 style="color:var(--gold)">üõí TIENDA</h3>
            <div class="tienda-box" id="lista-mejoras"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // TUS CREDENCIALES
        const firebaseConfig = {
            apiKey: "AIzaSyBw1pPRFEKgwlEAn_nbhlJghYQWHW-FiGM",
            authDomain: "cukicliker.firebaseapp.com",
            projectId: "cukicliker",
            storageBucket: "cukicliker.firebasestorage.app",
            messagingSenderId: "833749654955",
            appId: "1:833749654955:web:d84a745421aecedbf306ee"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        let puntos = 0;
        let inventario = [0, 0, 0, 0];
        const MEJORAS = [
            { id: 0, nombre: "Cursor", costo: 15, gps: 0.2 },
            { id: 1, nombre: "Abuela", costo: 100, gps: 1 },
            { id: 2, nombre: "Granja", costo: 1100, gps: 8 },
            { id: 3, nombre: "Mina", costo: 12000, gps: 47 }
        ];

        document.getElementById('btn-login').onclick = () => signInWithPopup(auth, provider);

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('ui-user').style.display = 'flex';
                document.getElementById('user-pic').src = user.photoURL;
                document.getElementById('user-display').innerText = user.displayName.split(' ')[0];
                
                const docSnap = await getDoc(doc(db, "jugadores", user.uid));
                if (docSnap.exists()) {
                    puntos = docSnap.data().puntos || 0;
                    inventario = docSnap.data().inventario || [0, 0, 0, 0];
                }
                actualizarTienda();
                iniciarRanking();
            }
        });

        document.getElementById('galleta').onclick = () => { puntos++; actualizarTienda(); };

        function actualizarTienda() {
            document.getElementById('puntos').innerText = Math.floor(puntos).toLocaleString();
            const cont = document.getElementById('lista-mejoras');
            cont.innerHTML = '';
            MEJORAS.forEach((m, i) => {
                const precio = Math.floor(m.costo * Math.pow(1.15, inventario[i]));
                const div = document.createElement('div');
                div.className = `mejora ${puntos >= precio ? 'comprable' : 'bloqueado'}`;
                div.innerHTML = `<span>${m.nombre} (${inventario[i]})</span> <b>üí∞${precio}</b>`;
                div.onclick = () => { if (puntos >= precio) { puntos -= precio; inventario[i]++; actualizarTienda(); } };
                cont.appendChild(div);
            });
        }

        function iniciarRanking() {
            const q = query(collection(db, "jugadores"), orderBy("puntos", "desc"), limit(10));
            onSnapshot(q, (snap) => {
                const rList = document.getElementById('ranking-list');
                rList.innerHTML = '';
                snap.forEach((doc, i) => {
                    const data = doc.data();
                    rList.innerHTML += `<div class="rank-item ${i<3?'top':''}"><span>#${i+1} ${data.nombre}</span><b>${Math.floor(data.puntos)}</b></div>`;
                });
            });
        }

        // Bucle de GPS
        setInterval(() => {
            let totalGPS = MEJORAS.reduce((t, m, i) => t + (inventario[i] * m.gps), 0);
            puntos += totalGPS / 10;
            document.getElementById('puntos').innerText = Math.floor(puntos).toLocaleString();
            document.getElementById('gps').innerText = totalGPS.toFixed(1);
        }, 100);

        // Guardado autom√°tico cada 8 seg
        setInterval(() => {
            if (auth.currentUser) {
                setDoc(doc(db, "jugadores", auth.currentUser.uid), { 
                    puntos: puntos, 
                    inventario: inventario, 
                    nombre: auth.currentUser.displayName.split(' ')[0] 
                }, { merge: true });
            }
        }, 8000);
    </script>
</body>
</html>
