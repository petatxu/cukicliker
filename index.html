<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CukiCliker Pro: Cloud Edition</title>
    <style>
        :root { --gold: #ffcc00; --bg: #121212; --panel: #2d2d2d; }
        
        body { 
            background: radial-gradient(circle, #3e2723, #0a0a0a); 
            color: white; 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            display: flex; 
            margin: 0; 
            height: 100vh; 
            overflow: hidden; 
        }

        /* Pantalla de Carga/Login */
        #login-overlay { 
            position: fixed; inset: 0; 
            background: rgba(0,0,0,0.95); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 1000; 
        }
        .btn-google { 
            background: #db4437; color: white; padding: 15px 40px; 
            border: none; border-radius: 50px; font-weight: bold; 
            cursor: pointer; font-size: 1.2rem; transition: 0.3s; 
            box-shadow: 0 4px 15px rgba(219, 68, 55, 0.4);
        }
        .btn-google:hover { transform: scale(1.05); background: #c53929; }

        /* Contenedor Principal */
        .game-container { flex: 1; display: flex; flex-direction: row; width: 100%; }

        /* Lado Izquierdo: Galleta */
        .seccion-galleta { 
            flex: 1.5; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
            border-right: 2px solid #000; 
        }
        #puntos { font-size: 4rem; font-weight: 900; color: var(--gold); margin: 0; text-shadow: 0 0 20px rgba(255,204,0,0.3); }
        #galleta { 
            width: 280px; height: 280px; cursor: pointer; font-size: 140px; 
            display: flex; align-items: center; justify-content: center; 
            background: #d2691e; border-radius: 50%; border: 10px solid #8b4513; 
            transition: transform 0.05s; box-shadow: 0 0 50px rgba(0,0,0,0.6);
            margin: 20px 0;
        }
        #galleta:active { transform: scale(0.92); }
        #galleta::after { content: "游꼵"; }

        /* Lado Derecho: Tienda y Chat */
        .seccion-derecha { width: 400px; display: flex; flex-direction: column; background: var(--panel); box-shadow: -5px 0 15px rgba(0,0,0,0.5); }
        
        .tab-container { display: flex; background: #1a1a1a; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; border-bottom: 3px solid transparent; transition: 0.3s; font-weight: bold; }
        .tab.active { border-bottom-color: var(--gold); color: var(--gold); background: #252525; }

        .content-area { flex: 1; overflow-y: auto; padding: 15px; display: none; }
        .content-area.active { display: block; }

        /* Estilos Mejoras */
        .mejora { 
            background: #3d3d3d; margin-bottom: 10px; padding: 12px; 
            border-radius: 8px; display: flex; justify-content: space-between; 
            align-items: center; cursor: pointer; border: 2px solid transparent; 
        }
        .mejora.comprable { border-color: #555; }
        .mejora.comprable:hover { border-color: var(--gold); background: #444; }
        .mejora.bloqueado { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }
        .costo-tag { color: var(--gold); font-weight: bold; }

        /* Estilos Chat */
        #chat-box { height: 300px; overflow-y: auto; background: #1a1a1a; padding: 10px; border-radius: 5px; display: flex; flex-direction: column; gap: 8px; margin-bottom: 10px; }
        .msg { font-size: 0.9rem; padding: 5px 10px; background: #333; border-radius: 5px; animation: fadeIn 0.3s; }
        .msg b { color: var(--gold); }
        #chat-input { width: 93%; padding: 10px; border: none; border-radius: 5px; background: #444; color: white; }

        /* Estilos Ranking */
        .rank-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #333; }
        .rank-item.yo { background: rgba(255, 204, 0, 0.1); border-left: 3px solid var(--gold); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .user-profile { position: absolute; top: 15px; left: 15px; display: flex; align-items: center; gap: 10px; background: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 30px; }
        .user-profile img { width: 30px; border-radius: 50%; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <h1>游꼵 CukiCliker Cloud</h1>
        <p>Inicia sesi칩n para competir con el mundo</p>
        <button class="btn-google" id="btn-login">Entrar con Google</button>
        <p id="error-msg" style="color: #ff4444; margin-top: 15px;"></p>
    </div>

    <div class="user-profile" id="user-info" style="display:none;">
        <img id="user-img" src="" alt="">
        <span id="user-name">Jugador</span>
    </div>

    <div class="game-container">
        <div class="seccion-galleta">
            <h1 id="puntos">0</h1>
            <p>galletas horneadas</p>
            <div id="galleta"></div>
            <p>Producci칩n: <span id="gps">0.0</span> / seg</p>
        </div>

        <div class="seccion-derecha">
            <div class="tab-container">
                <div class="tab active" onclick="switchTab('tienda')">TIENDA</div>
                <div class="tab" onclick="switchTab('ranking')">RANKING</div>
                <div class="tab" onclick="switchTab('chat')">CHAT</div>
            </div>

            <div id="tienda" class="content-area active">
                <div id="lista-mejoras"></div>
            </div>

            <div id="ranking" class="content-area">
                <div id="lista-ranking">Cargando clasificaci칩n...</div>
            </div>

            <div id="chat" class="content-area">
                <div id="chat-box"></div>
                <input type="text" id="chat-input" placeholder="Presiona Enter para enviar...">
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, query, orderBy, limit, onSnapshot, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIGURACI칍N DE ERIC
        const firebaseConfig = {
            apiKey: "AIzaSyBw1pPRFEKgwlEAn_nbhlJghYQWHW-FiGM",
            authDomain: "cukicliker.firebaseapp.com",
            projectId: "cukicliker",
            storageBucket: "cukicliker.firebasestorage.app",
            messagingSenderId: "833749654955",
            appId: "1:833749654955:web:d84a745421aecedbf306ee",
            measurementId: "G-J01MPBQ4BQ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // VARIABLES DE JUEGO
        let puntos = 0;
        let userActual = null;
        const DATOS_MEJORAS = [
            { id: 0, nombre: "Cursor", baseCosto: 15, gps: 0.1, desc: "Autoclick b치sico" },
            { id: 1, nombre: "Abuela", baseCosto: 100, gps: 1, desc: "Hornea con amor" },
            { id: 2, nombre: "Granja", baseCosto: 1100, gps: 8, desc: "Cultivo masivo" },
            { id: 3, nombre: "Mina", baseCosto: 12000, gps: 47, desc: "Extrae pepitas" },
            { id: 4, nombre: "F치brica", baseCosto: 130000, gps: 260, desc: "L칤nea de montaje" }
        ];
        let inventario = new Array(DATOS_MEJORAS.length).fill(0);

        // LOGIN
        document.getElementById('btn-login').onclick = async () => {
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                document.getElementById('error-msg').innerText = "Error: Usa Live Server y revisa la consola.";
                console.error(error);
            }
        };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userActual = user;
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('user-info').style.display = 'flex';
                document.getElementById('user-img').src = user.photoURL;
                document.getElementById('user-name').innerText = user.displayName.split(' ')[0];
                
                // Cargar progreso
                const docSnap = await getDoc(doc(db, "jugadores", user.uid));
                if (docSnap.exists()) {
                    puntos = docSnap.data().puntos || 0;
                    inventario = docSnap.data().inventario || inventario;
                }
                actualizarInterfaz();
                iniciarEscuchasRankingYChat();
            }
        });

        // L칍GICA DE CLIC Y GPS
        document.getElementById('galleta').onclick = () => {
            puntos++;
            actualizarInterfaz();
        };

        function getGPS() {
            return DATOS_MEJORAS.reduce((t, m, i) => t + (inventario[i] * m.gps), 0);
        }

        // TIENDA
        function actualizarInterfaz() {
            document.getElementById('puntos').innerText = Math.floor(puntos).toLocaleString();
            document.getElementById('gps').innerText = getGPS().toFixed(1);
            
            const cont = document.getElementById('lista-mejoras');
            cont.innerHTML = '';
            DATOS_MEJORAS.forEach((m, i) => {
                const precio = Math.floor(m.baseCosto * Math.pow(1.15, inventario[i]));
                const div = document.createElement('div');
                div.className = `mejora ${puntos >= precio ? 'comprable' : 'bloqueado'}`;
                div.innerHTML = `
                    <div><b>${m.nombre}</b> (${inventario[i]})<br><small>${m.desc}</small></div>
                    <div class="costo-tag">游눯 ${precio}</div>
                `;
                div.onclick = () => {
                    if (puntos >= precio) {
                        puntos -= precio;
                        inventario[i]++;
                        actualizarInterfaz();
                    }
                };
                cont.appendChild(div);
            });
        }

        // CHAT
        const chatInput = document.getElementById('chat-input');
        chatInput.onkeydown = async (e) => {
            if (e.key === 'Enter' && chatInput.value.trim() !== "" && userActual) {
                await addDoc(collection(db, "chat"), {
                    nombre: userActual.displayName.split(' ')[0],
                    texto: chatInput.value,
                    fecha: serverTimestamp()
                });
                chatInput.value = "";
            }
        };

        function iniciarEscuchasRankingYChat() {
            // Ranking en vivo
            const qRank = query(collection(db, "jugadores"), orderBy("puntos", "desc"), limit(10));
            onSnapshot(qRank, (snap) => {
                const list = document.getElementById('lista-ranking');
                list.innerHTML = '';
                snap.forEach((doc, i) => {
                    const d = doc.data();
                    const esYo = doc.id === userActual.uid ? 'yo' : '';
                    list.innerHTML += `<div class="rank-item ${esYo}"><span>#${i+1} ${d.nombre}</span><b>${Math.floor(d.puntos).toLocaleString()}</b></div>`;
                });
            });

            // Chat en vivo
            const qChat = query(collection(db, "chat"), orderBy("fecha", "asc"), limit(20));
            onSnapshot(qChat, (snap) => {
                const box = document.getElementById('chat-box');
                box.innerHTML = '';
                snap.forEach(doc => {
                    const d = doc.data();
                    box.innerHTML += `<div class="msg"><b>${d.nombre}:</b> ${d.texto}</div>`;
                });
                box.scrollTop = box.scrollHeight;
            });
        }

        // BUCLES AUTOM츼TICOS
        setInterval(() => {
            puntos += getGPS() / 10;
            document.getElementById('puntos').innerText = Math.floor(puntos).toLocaleString();
        }, 100);

        // Guardado en la nube cada 10 seg
        setInterval(() => {
            if (userActual) {
                setDoc(doc(db, "jugadores", userActual.uid), {
                    nombre: userActual.displayName.split(' ')[0],
                    puntos: puntos,
                    inventario: inventario,
                    ultimaVez: serverTimestamp()
                }, { merge: true });
            }
        }, 10000);

        // Sistema de pesta침as (Tabs)
        window.switchTab = (tabId) => {
            document.querySelectorAll('.content-area').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        };

        actualizarInterfaz();
    </script>
</body>

</html>
